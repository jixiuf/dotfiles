# https://github.com/k0kubun/xremap
# key 的名字参见
# https://github.com/emberian/evdev/blob/1d020f11b283b0648427a2844b6b980f1a268221/src/scancodes.rs#L26-L572
# sudo systemctl restart xremap
# super = cmd on macos and win on windows
# journalctl -u xremap
keymap:
  - name: firefox
    application:
      only: [firefox,firefox-esr]
    remap:
    # http://7is7.com/software/firefox/shortcuts.html
      M-backspace: C-Backspace
      C-u: C-Shift-t
      C-comma: C-Pageup
      C-dot: C-Pagedown
      C-r: C-r
      C-7: C-Shift-l
      C-h: M-left
      C-l: M-right
      C-o: C-l
      C-n: down
      C-p: up
      C-f: right
      C-b: left
      C-v: pagedown
      M-v: pageup
  - name: Google Chrome
    application:
      only: [Google-chrome,google-chrome]
    remap:
      M-backspace: C-Backspace
      Super-C-u: C-Shift-t
      C-comma: C-Shift-tab
      C-dot: C-tab
      C-r: C-r
      C-h: M-left
      C-l: M-right
      C-o: C-l
      C-n: down
      C-p: up
      C-f: right
      C-b: left
      C-a: Home
      C-e: End
      M-f: C-right
      M-b: C-left
      Super-M-f: Super-C-right
      Super-M-b: Super-C-left
      # Super-C-f: Super-C-f      #否则会变成 Super-right,因上面 C-f->right
      Super-C-b: Super-C-b
      Super-C-a: C-a
      Super-C-w: C-f4           # close tab

  - name: Emacs
    application:
      only: [emacs,Emacs]
    remap:
      C-Space: Super-C-Space
      C-g: [Super-Space,f15]
      # C-x: C-x
      Super-C-g: Super-C-g


  - name: Terminal
    application:
      only: [dterm,Alacritty,alacritty]
    remap:
      C-2: C-Shift-Space        # Alacritty vi mode,v:select,i: quit
      Super-C-Enter: Shift-C-Enter # new  Alacritty in pwd
      C-x:
        remap:
          C-x: C-x              # C-xC-x send C-x
          C-c: { launch: ["sway-kill"] }
      C-c:
        remap:
          C-c: C-c              # C-xC-x send C-x
          C-e: C-Shift-M        # hints

  - name: Default -- some of these are overridden by the above definitions
    application:
      not: [Gnome-terminal, Emacs,emacs ,foot,Foot,dterm,Alacritty,alacritty]
      # not: [Google-chrome, Slack, Gnome-terminal, jetbrains-idea,emacs]
    remap:
      Super-C-a: C-a
      Super-C-c: C-c
      Super-C-v: C-v
      Super-C-z: C-z
      Super-C-s: C-s
      # C-x: Super-C-M-x
      # Super-C-x: [Super-C-M-x,C-x]
      # C-M-x: C-M-x
      # Super-M-x: Super-M-x
      # Cursor
      C-b: { with_mark: left }
      C-f: { with_mark: right }
      C-p: { with_mark: up }
      C-n: { with_mark: down }
      # Forward/Backward word
      M-b: { with_mark: C-left }
      M-f: { with_mark: C-right }
      # Beginning/End of line
      C-a: { with_mark: home }
      C-e: { with_mark: end }
      # Page up/down
      M-v: { with_mark: pageup }
      C-v: { with_mark: pagedown }
      # Beginning/End of file
      M-Shift-comma: { with_mark: C-home }
      M-Shift-dot: { with_mark: C-end }
      # Newline
      C-m: enter
      C-j: enter
      C-o: [enter, left]
      # Copy
      # C-w: [C-x, { set_mark: false }]
      M-w: [C-c, { set_mark: false }]
      C-y: [C-v, { set_mark: false }]
      # Delete
      C-d: [delete, { set_mark: false }]
      M-d: [C-delete, { set_mark: false }]
      # Kill line
      C-k: [Shift-end, C-x, { set_mark: false }]
      # Undo
      C-slash: [C-z, { set_mark: false }]
      C-Shift-ro: C-z
      # Mark
      # C-2: { set_mark: true }
      # Search
      C-s: F3
      C-r: Shift-F3
      M-Shift-5: C-h
      # Cancel
      C-g: [esc, { set_mark: false }]
      # C-x YYY
      C-x:
        remap:
          C-x: C-x              # C-xC-x send C-x
          # C-x h (select all)
          h: [C-home, C-a, { set_mark: true }]
          # C-x C-f (open)
          C-f: C-o
          # C-x C-s (save)
          C-s: C-s
          # C-x k (kill tab)
          k: C-f4
          # C-x C-c (exit)
          C-c: { launch: ["sway-kill" ] }

  - name: Global
    remap:
      Super-C-e: { launch: ["sway-run-or-raise","emacs","runemacs"] }
      Super-C-f: { launch: ["sway-run-or-raise","firefox","firefox |firefox-bin"] }
      # Super-C-f: { launch: ["sway-run-or-raise","google-chrome","google-chrome-stable"] }
      Super-C-d: { launch: ["sway-run-or-raise", "--cd","--floating-only","--","dterm","nohup alacritty  --working-directory=$(sway-cwd||echo $HOME) --class=dterm "] }
      Super-C-comma: { launch: ["sway-run-or-raise", "--floating-only","--","dterm","nohup alacritty  --working-directory=$(sway-cwd||echo $HOME) --class=dterm "] }
      Super-C-b: { launch: ["sway-run-or-raise","weixin","weixin-uos 2>&1 >/dev/null"] }
      Super-C-3: { launch: ["sway-run-or-raise","Bytedance-feishu","bytedance-feishu-stable  2>&1 >/dev/null"] }
      Super-C-7: { launch: ["swaylock","--ignore-empty-password", "--show-failed-attempts", "--color", "1e1e1e", "--inside-color", "cccccc" ,"--ring-color", "ffffff", "--inside-clear-color","11a8cd", "--ring-clear-color", "29b8db","--inside-ver-color", "2472c8", "--ring-ver-color", "3b8eea", "--inside-wrong-color","cd3131","--ring-wrong-color","f14c4c"] }
      Super-C-8: { launch: ["sway-run-or-raise","corplink","/opt/Corplink/corplink"] }
      Super-C-9: { launch: ["pick-color"] }
      # Super-C-r: { launch: ["run-bemenu"] }
      C-Tab: { launch: ["run-bemenu"] }
      Super-C-Enter: { launch: ["sh","-c","nohup alacritty --working-directory=$(sway-cwd||echo $HOME)"] }
      Super-C-q: { launch: ["swaymsg","kill"] }
      Super-M-q: { launch: ["swaymsg","exit"] }

      Super-M-i: { launch: ["swaymsg","splith"] }
      Super-M-v: { launch: ["swaymsg","splitv"] }
      Super-M-t: { launch: ["swaymsg","layout toggle split"] }
      Super-C-Backslash: { launch: ["sway-toggle-split"] }
      Super-M-f: { launch: ["swaymsg","floating toggle"] }
      Super-M-f: { launch: ["swaymsg","floating toggle"] }
      Super-M-h: { launch: ["swaymsg","move scratchpad"] }
      Super-C-M-h: { launch: ["swaymsg","scratchpad show"] }

      Super-C-o: { launch: ["sway-focus-next"] }
      Super-C-1: { launch: ["sway-kill-other-window"] }
      Super-C-m: { launch: ["swaymsg","fullscreen"] }
      Super-C-w: Super-C-w
      Super-C-n: { launch: ["swaymsg" ,"workspace next"]}
      Super-C-p: { launch: ["swaymsg" ,"workspace prev"]}
      Super-M-comma: { launch: ["swaymsg" ,"resize shrink width 15px"]}
      Super-M-dot: { launch: ["swaymsg" ,"resize grow width 15px"]}
      Super-C-M-comma: { launch: ["swaymsg" ,"resize shrink height 15px"]}
      Super-C-M-dot: { launch: ["swaymsg" ,"resize grow height 15px"]}

      C-w:
        remap:
          C-w: C-w              # C-wC-w send C-w
          Enter: { launch: ["sway-toggle-split"] }
          C-r: { launch: ["swaymsg","reload"] }
          "1": { launch: ["sway-kill-other-window"] }
          C-o: { launch: ["sway-focus-next"] }
          o: { launch: ["sway-focus-next"] }

          C-h: { launch: ["sh","-c","swaymsg focus left;notify-send -t 3000 'C-w:\n  C-h/j/k/l focus\n  C-u:focus parent\n  C-i:focus child\n  C-o:focus next' "] }
          C-j: { launch: ["sh","-c","swaymsg focus down;notify-send -t 3000 'C-w:\n  C-h/j/k/l focus\n  C-u:focus parent\n  C-i:focus child\n  C-o:focus next' "] }
          C-k: { launch: ["sh","-c","swaymsg focus up;notify-send -t 3000 'C-w:\n  C-h/j/k/l focus\n  C-u:focus parent\n  C-i:focus child\n  C-o:focus next' "] }
          C-l: { launch: ["sh","-c","swaymsg focus right;notify-send -t 3000 'C-w:\n  C-h/j/k/l focus\n  C-u:focus parent\n  C-i:focus child\n  C-o:focus next' "] }
          C-u: { launch: ["sh","-c","swaymsg focus parent;notify-send -t 3000 'C-w:\n  C-h/j/k/l focus\n  C-u:focus parent\n  C-i:focus child\n  C-o:focus next' "] }
          C-i: { launch: ["sh","-c","swaymsg focus child;notify-send -t 3000 'C-w:\n  C-h/j/k/l focus\n  C-u:focus parent\n  C-i:focus child\n  C-o:focus next' "] }

          h: { launch: ["swaymsg","mark --add \"_swap\", focus left, swap container with mark \"_swap\", focus left, unmark \"_swap\" " ] }

          j: { launch: ["swaymsg","mark --add \"_swap\", focus down, swap container with mark \"_swap\", focus down, unmark \"_swap\" " ] }
          k: { launch: ["swaymsg","mark --add \"_swap\", focus up, swap container with mark \"_swap\", focus up, unmark \"_swap\" " ] }
          l: { launch: ["swaymsg","mark --add \"_swap\", focus right, swap container with mark \"_swap\", focus right, unmark \"_swap\" " ] }

          #mark a window
          m: { launch: ["swaymsg","mark --add \"_swapping\"" ] }
          # sway with the marked window
          C-m: { launch: ["swaymsg","swap container with mark \"_swapping\", \"[con_mark=_swapping] focus\", unmark \"_swapping\"" ] }

          # these reflect the position on the keyboard:
          # w e r
          # s d f
          # x c v
          w:  { launch: ["sway-move-to" ,"top-left"]}
          e:  { launch: ["sway-move-to" ,"mid-top"]}
          r:  { launch: ["sway-move-to" ,"top-right"]}
          s:  { launch: ["sway-move-to" ,"mid-left"]}
          d:  { launch: ["sway-move-to" ,"centre"]}
          f:  { launch: ["sway-move-to" ,"mid-right"]}
          x:  { launch: ["sway-move-to" ,"bottom-left"]}
          c:  { launch: ["sway-move-to" ,"mid-bottom"]}
          v:  { launch: ["sway-move-to" ,"bottom-right"]}


          C-1: { launch: ["swaymsg" ,"workspace number  1"]}
          C-2: { launch: ["swaymsg" ,"workspace number  2"]}
          C-3: { launch: ["swaymsg" ,"workspace number  3"]}
          C-4: { launch: ["swaymsg" ,"workspace number  4"]}
          C-5: { launch: ["swaymsg" ,"workspace number  5"]}
          C-6: { launch: ["swaymsg" ,"workspace number  6"]}
          C-7: { launch: ["swaymsg" ,"workspace number  7"]}
          C-8: { launch: ["swaymsg" ,"workspace number  8"]}
          C-9: { launch: ["swaymsg" ,"workspace number  9"]}

          n: { launch: ["swaymsg" ,"workspace next"]}
          p: { launch: ["swaymsg" ,"workspace prev"]}
          C-n: { launch: ["swaymsg" ,"workspace next"]}
          C-p: { launch: ["swaymsg" ,"workspace prev"]}
          down: { launch: ["swaymsg" ,"workspace next"]}
          up: { launch: ["swaymsg" ,"workspace prev"]}

          C-e: { launch: ["sway-next-empty-workspace" ,"--take-focused"]}
          C-v: { launch: ["sway-next-empty-workspace" ,"--reverse  --take-focused"]}
          C-b: { launch: ["sway-move-to-prev-workspace"]}
          C-f: { launch: ["sway-move-to-next-workspace"]}
